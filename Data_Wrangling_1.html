<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data_Wrangling_1.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 52px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h2 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h3 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h4 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h5 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h6 {
  padding-top: 57px;
  margin-top: -57px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">TBEP R Training</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="R_Basics.html">
    <span class="fa fa-university"></span>
     
    R Basics
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-wrench"></span>
     
    Data wrangling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Data_Wrangling_1.html">Part 1</a>
    </li>
    <li>
      <a href="Data_Wrangling_2.html">Part 2</a>
    </li>
  </ul>
</li>
<li>
  <a href="Viz_and_Graphics.html">
    <span class="fa fa-chart-line"></span>
     
    Viz and graphics
  </a>
</li>
<li>
  <a href="mapping.html">
    <span class="fa fa-globe-americas"></span>
     
    Spatial analysis and mapping
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Resources.html">
    <span class="fa fa-list"></span>
     
    Resources
  </a>
</li>
<li>
  <a href="https://github.com/tbep-tech/tbep-r-training">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="data-wrangling-part-1" class="section level1">
<h1>Data wrangling part 1</h1>
<div id="lesson-outline" class="section level2">
<h2>Lesson Outline</h2>
<ul>
<li><a href="#todays-goals">Today’s goals</a></li>
<li>[The tidyverse]</li>
<li>[Data wrangling with <code>dplyr</code>]</li>
<li>[Piping]</li>
</ul>
</div>
<div id="lesson-exercises" class="section level2">
<h2>Lesson Exercises</h2>
<ul>
<li>[Exercise 1]</li>
<li>[Exercise 2]</li>
<li>[Exercise 3]</li>
</ul>
</div>
<div id="todays-goals" class="section level2">
<h2>Today’s goals</h2>
<p>Data wrangling (manipulation, ninjery, cleaning, etc.) is the part of any data analysis that will take the most time. While it may not necessarily be fun, it is foundational to all the work that follows. I strongly believe that mastering these skills has more value than mastering a particular analysis. Check out <a href="https://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html">this article</a> if you don’t believe me.</p>
<!-- As before, we only have two hours to cover the basics of data wrangling. It’s an unrealistic expectation that you will be a ninja wrangler after this training. As such, the goals are to expose you to fundamentals and to develop an appreciation of what’s possible. I also want to provide resources that you can use for follow-up learning on your own. -->
<!-- Today you should be able to answer (or be able to find answers to) the following: -->
<!-- * Why do we need to manipulate data? -->
<!-- * What is the tidyverse?  -->
<!-- * What can you do with dplyr? -->
<!-- * What is piping? -->
<!-- ## Exercise 1 -->
<!-- As a refresher and to get our brains working, we're going to repeat the exercises from our training last week.  The only exception is that we'll be using some data from the Bight.  In this exercise, we'll make a new project in RStudio and create a script for importing and working with these data today. -->
<!-- 1. Start RStudio: To start both R and RStudio requires only firing up RStudio.  RStudio should be available from All Programs at the Start Menu.  Fire up RStudio. Take a minute or two to orient yourself to the different panes if you need a refresher from last time.  -->
<!-- 2. Create a new project.  Name it "wrangling_workshop" or something similar. -->
<!-- 3. Create a new "R Script" in the Source (scripting) Pane, save that file into your project and name it "data_wrangling1.R". It'll just be a blank text file at this point. -->
<!-- 4. Add in a comment line at the top stating the purpose. It should look something like: `# Exercise 1: Scripting for data wrangling part 1`. -->
<!-- 5. Make a folder in your project called `data`. You should have downloaded this already, but if not, download the Bight dataset from here: [https://github.com/SCCWRP/R_training_2018/raw/master/lessons/data/B13 Chem data.xlsx](https://github.com/SCCWRP/R_training_2018/raw/master/lessons/data/B13 Chem data.xlsx). Also download some metadata about the Bight stations from here: [https://github.com/SCCWRP/R_training_2018/raw/master/lessons/data/Master Data - Station Info.xlsx](https://github.com/SCCWRP/R_training_2018/raw/master/lessons/data/Master Data - Station Info.xlsx). Copy these files into the `data` folder in your project. -->
<!-- 6. Add some lines to your script to import and store the data in your Enviroment. Remember that the data should be in your `data` folder in your project.  The `read_excel` function from the `readxl` package is your friend here and the paths are `"data/B13 Chem data.xlsx"` and `"data/Master Data - Station Info.xlsx"`.  Remember to install/load the `readxl` library and to assign the data to a variable (`<-`) -->
<!-- 7. Now run your script and make sure it doesn't throw any errors and you do in fact get a data frame (or tibble). -->
<!-- 8. Explore the data frame using some of the functions we covered last time (e.g. `head()`,`dim()`, or `str()`).  This part does not need to be included in the script and can be done directly in the console. It is just a quick QA step to be sure the data read in as expected. -->
<!-- ## The tidyverse -->
<!-- The [tidyverse](https://www.tidyverse.org/) is a set of packages that work in harmony because they share common data representations and design. The tidyverse package is designed to make it easy to install and load core packages from the tidyverse in a single command. With tidyverse, you'll be able to address all steps of data exploration.   -->
<!-- ![](figure/data-science.png) -->
<!-- From the excellent book, [R for Data Science](http://r4ds.had.co.nz/), **data exploration** is the art of looking at your data, rapidly generating hypotheses, quickly testing them, then repeating again and again and again.  Tools in the tidyverse also have direct application to more formal analyses with many of the other available R packages on [CRAN](https://cran.r-project.org/). -->
<!-- You should already have the tidyverse installed, but let's give it a go if you haven't done this part yet: -->
<!-- ```{r eval = F} -->
<!-- # install  -->
<!-- install.packages('tidyverse') -->
<!-- ``` -->
<!-- After installation, we can load the package: -->
<!-- ```{r message = T} -->
<!-- # load -->
<!-- library(tidyverse) -->
<!-- ``` -->
<!-- Notice that the messages you get after loading are a bit different from other packages.  That's because tidyverse is a package that manages other packages.  Loading tidyverse will load all of the core packagbes: -->
<!-- -   [ggplot2](http://ggplot2.tidyverse.org), for data visualisation. -->
<!-- -   [dplyr](http://dplyr.tidyverse.org), for data manipulation. -->
<!-- -   [tidyr](http://tidyr.tidyverse.org), for data tidying. -->
<!-- -   [readr](http://readr.tidyverse.org), for data import. -->
<!-- -   [purrr](http://purrr.tidyverse.org), for functional programming. -->
<!-- -   [tibble](http://tibble.tidyverse.org), for tibbles, a modern re-imagining of data frames. -->
<!-- Other packages (e.g., `readxl`) are also included but you will probably not use these as frequently.   -->
<!-- A nice freature of tidyverse is the ability to check for and install new versions of each package: -->
<!-- ``` r -->
<!-- tidyverse_update() -->
<!-- #> The following packages are out of date: -->
<!-- #>  * broom (0.4.0 -> 0.4.1) -->
<!-- #>  * DBI   (0.4.1 -> 0.5) -->
<!-- #>  * Rcpp  (0.12.6 -> 0.12.7) -->
<!-- #> Update now? -->
<!-- #>  -->
<!-- #> 1: Yes -->
<!-- #> 2: No -->
<!-- ``` -->
<!-- As you'll soon learn using R, there are often several ways to achieve the same goal.  The tidyverse provides tools to address problems that can be solved with other packages or even functions from the base installation.  Tidyverse is admittedly an *opinionated* approach to data exploration, but it's popularity and rapid growth within the R community is a testament to the power of the tools that are provided.  -->
<!-- ## Data wrangling with `dplyr` -->
<!-- ![](figure/data-science-wrangle.png) -->
<!-- As the graphic implies, the data wrangling process includes data import, tidying, and transformation.  The process directly feeds into, and is not mutually exclusive, with the *understanding* or modelling side of data exploration.  More generally, I consider data wrangling as the manipulation or combination of datasets for the purpose of analysis.   -->
<!-- Wrangling begins with import and ends with an output of some kind, such as a plot or a model.  In a perfect world, the wrangling process is linear with no need for back-tracking.  In reality, we often uncover more information about a dataset, either through wrangling or modeling, that warrants re-evaluation or even gathering more data.  Data also come in many forms and the form you need for analysis is rarely the required form of the input data.  For these reasons, data wrangling will consume most of your time in data exploration.  -->
<!-- **All wrangling is based on a purpose.**  No one wrangles for the sake of wrangling (usually), so the process always begins by answering the following two questions: -->
<!-- * What do my input data look like? -->
<!-- * What should my input data look like given what I want to do? -->
<!-- At the most basic level, going from what your data looks like to what it should look like will require a few key operations.  Some common examples: -->
<!-- * Selecting specific variables -->
<!-- * Filtering observations by some criteria -->
<!-- * Adding or modifying existing variables -->
<!-- * Renaming variables -->
<!-- * Arranging rows by a variable -->
<!-- * Summarizing variable conditional on others -->
<!-- The `dplyr` package provides easy tools for these common data manipulation tasks. It is built to work directly with data frames and this is one of the foundational packages in what is now known as the tidyverse. The philosophy of dplyr is that one function does one thing and the name of the function says what it does. This is where the tidyverse generally departs from other packages and even base R.  It is meant to be easy, logical, and intuitive.  There is a lot of great info on dplyr. If you have an interest, I’d encourage you to look more. The vignettes are particularly good. -->
<!-- * [`dplyr` GitHub repo](https://github.com/hadley/dplyr) -->
<!-- * [CRAN page: vignettes here](http://cran.rstudio.com/web/packages/dplyr/) -->
<!-- * [Cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf) -->
<!-- I'll demonstrate the examples with the `mpg` dataset from last time. This dataset describes fuel economy of different vehicles and it comes with the tidyverse. Let's get a feel for the data. -->
<!-- ```{r} -->
<!-- # convert to data frame, just cause -->
<!-- mpg <- as.data.frame(mpg) -->
<!-- # see first six rows -->
<!-- head(mpg) -->
<!-- # dimensions -->
<!-- dim(mpg) -->
<!-- # column names -->
<!-- names(mpg) -->
<!-- # structure  -->
<!-- str(mpg) -->
<!-- ``` -->
<!-- ### Selecting -->
<!-- Let's begin using dplyr. Don't forget to load the tidyverse if you haven't done so already.  -->
<!-- ```{r} -->
<!-- # first, select some columns -->
<!-- dplyr_sel1 <- select(mpg, manufacturer, model, cty, hwy) -->
<!-- head(dplyr_sel1) -->
<!-- # select everything but class and drv -->
<!-- dplyr_sel2 <- select(mpg, -drv, -class) -->
<!-- head(dplyr_sel2) -->
<!-- # select columns that contain the letter c -->
<!-- dplyr_sel3 <- select(mpg, matches('c')) -->
<!-- head(dplyr_sel3) -->
<!-- ``` -->
<!-- ### Filtering -->
<!-- After selecting columns, you'll probably want to remove observations that don't fit some criteria.  For example, maybe you want to remove all cars from the dataset that have low mileage on the highway.  Maybe you want to look at only six cylinder cars. -->
<!-- ```{r} -->
<!-- # now select (filter) some observations -->
<!-- dplyr_good_fuel <- filter(mpg, hwy > 25) -->
<!-- head(dplyr_good_fuel) -->
<!-- # now select observations for only six cylinder vehicles -->
<!-- dplyr_six_cyl <- filter(mpg, cyl == 6) -->
<!-- head(dplyr_six_cyl) -->
<!-- ``` -->
<!-- Filtering can take a bit of time to master because there are several ways to tell R what you want. Within the filter function, the working part is a *logical selection* of `TRUE` and `FALSE` values that are used to selected rows (`TRUE` means I want that row, `FALSE` means I don't).  Every selection within the filter function, no matter how complicated, will always be a T/F vector.  This is similar to running queries on a database if you're familiar with SQL. -->
<!-- To use filtering effectively, you have to know how to select the observations that you want using the comparison operators. R provides the standard suite: `>`, `>=`, `<`, `<=`, `!=` (not equal), and `==` (equal). When you're starting out with R, the easiest mistake to make is to use `=` instead of `==` when testing for equality.  -->
<!-- Multiple arguments to `filter()` are combined with "and": every expression must be true in order for a row to be included in the output. For other types of combinations, you'll need to use Boolean operators yourself: `&` is "and", `|` is "or", and `!` is "not". This is the complete set of Boolean operations. -->
<!-- ![](figure/transform-logical.png) -->
<!-- Let's start combining filtering operations. -->
<!-- ```{r} -->
<!-- # get cars with city mileage betwen 18 and 22 -->
<!-- filt1 <- filter(mpg, cty > 18 & cty < 22) -->
<!-- head(filt1) -->
<!-- # get four cylinder or compact cars -->
<!-- filt2 <- filter(mpg, cyl == 4 | class == 'compact') -->
<!-- head(filt2) -->
<!-- # get four cylinder and compact cars -->
<!-- filt3 <- filter(mpg, cyl == 4 & class == 'compact') -->
<!-- head(filt3) -->
<!-- # get cars manufactured by ford or toyota -->
<!-- filt4 <- filter(mpg, manufacturer == 'ford' | manufacturer == 'toyota') -->
<!-- head(filt4) -->
<!-- # an alternative way to get ford and toyota  -->
<!-- filt5 <- filter(mpg, manufacturer %in% c('ford', 'toyota')) -->
<!-- head(filt5) -->
<!-- ``` -->
<!-- ### Mutating -->
<!-- Now that we've seen how to filter observations and select columns of a data frame, maybe we want to add a new column. In dplyr, `mutate` allows us to add new columns. These can be vectors you are adding or based on expressions applied to existing columns. For instance, we have a column of highway mileage and maybe we want to convert to km/l (Google says the conversion factor is 0.425). -->
<!-- ```{r} -->
<!-- # add a column for km/L -->
<!-- dplyr_mut <- mutate(mpg, hwy_kml = hwy * 0.425) -->
<!-- head(dplyr_mut) -->
<!-- # add a column for lo/hi fuel economy -->
<!-- dplyr_mut2 <- mutate(mpg, hwy_cat = ifelse(hwy < 25, 'hi', 'lo')) -->
<!-- head(dplyr_mut2) -->
<!-- ``` -->
<!-- Some other useful dplyr functions include `arrange` to sort the observations (rows) by a column and `rename` to (you guessed it) rename a column. -->
<!-- ```{r} -->
<!-- # arrange by highway economy -->
<!-- dplyr_arr <- arrange(mpg, hwy) -->
<!-- head(dplyr_arr) -->
<!-- # rename some columns -->
<!-- dplyr_rnm <- rename(mpg, make = manufacturer) -->
<!-- head(dplyr_rnm) -->
<!-- ``` -->
<!-- There are many more functions in `dplyr` but the one's above are by far the most used.  As you can imagine, they are most effective when used to together because there is never only one step in the data wrangling process.  After the exercise, we'll talk about how we can efficiently *pipe* the functions in dplyr to create a new data object.   -->
<!-- ## Exercise 2 -->
<!-- Now that you know the basic functions in `dplyr` and how to use them, let's apply them to a more relevant dataset.  We're going to import the sediment chemistry dataset from Bight13 and grab some specific data that we want. We'll be getting all of the observations for chlorophyll (`Total_CHL`) and organic carbon (`Total Organic Carbon`).  We'll remove everything else in the data that we don't need. -->
<!-- 1. Import the Bight chemistry data using the `read_excel` function from the readxl package. The data should be in your `data` folder. Make sure to store it as an object in your workspace (use `<-`). -->
<!-- 2. Now we need to think about what variables we need to get the chlorophyll data.  Select the `StationID`, `Parameter`, and `Result` columns and assign it as a new object in your environment. -->
<!-- 3. Using the new object, let's filter the observations (i.e., the `Parameter` column) to get only chlorophyll (`Total_CHL`) and organic carbon (`Total Organic Carbon`). Again, assign the new object to your environment. -->
<!-- 4. When you're happy with the result, have a look at the data.  Did you get what you wanted?  How many observations do you have compared to the original data file? Did you succesfully filter the right parameters (hint: `table(dat$Parameter)`?  -->
<!-- 5. Save the new file to your data folder using `write_csv` and call it `Bight_wrangle.csv`. Don't forget to include the full path within your project when saving the file.   -->
<!-- ## Piping -->
<!-- A complete data wrangling exercise will always include multiple steps to go from the raw data to the output you need. Here's a terrible wrangling example using functions from base R: -->
<!-- ```{r base, eval=FALSE} -->
<!-- cropdat <- rawdat[1:28] -->
<!-- savecols <- data.frame(cropdat$Party, cropdat$`Last Inventory Year (2015)`) -->
<!-- names(savecols) <- c('Party','2015') -->
<!-- savecols$rank2015 <- rank(-savecols$`2015`) -->
<!-- top10df <- savecols[savecols$rank2015 <= 10,] -->
<!-- basedat <- cropdat[cropdat$Party %in% top10df$Party,] -->
<!-- ``` -->
<!-- Technically, if this works it's not "wrong", but there are a couple issues that can lead to problems down the line. First, the flow of functions to manipulate the data is not obvious and this makes your code very hard to read. Second, lots of unecessary intermediates have been created in your workspace.  Anything that adds to clutter should be avoided because R is fundamentally based on object assignments.  The less you assign as a variable in your environment the easier it will be to navigate complex scripts.  -->
<!-- The good news is that you now know how to use the dplyr functions to wrangle data.  The function names in dplyr were chosen specifically to be descriptive.  This will make your code much more readable than if you were using base R counterparts.  The bad news is that I haven't told you how to easily link the functions.  Fortunately, there's an easy fix to this problem. -->
<!-- The `magrittr` package (comes with tidyverse) provides a very useful method called *piping* that will make wrangling a whole lot easier.  The idea is simple: a pipe (`%>%`) is used to chain functions together.  The output from one function becomes the input to the next function in the pipe. This avoids the need to create intermediate objects and creates a logical progression of steps that demystify the wrangling process. -->
<!-- Consider the simple example: -->
<!-- ```{r} -->
<!-- # not using pipes, select a column, filter rows -->
<!-- bad_ex <- select(mpg, manufacturer, hwy) -->
<!-- bad_ex2 <- filter(bad_ex, hwy > 25) -->
<!-- ``` -->
<!-- With pipes, it looks like this: -->
<!-- ```{r} -->
<!-- # with pipes, select a column, filter rows -->
<!-- good_ex <- select(mpg, manufacturer, hwy) %>%  -->
<!--   filter(hwy > 25) -->
<!-- ``` -->
<!-- Now we've created only one new object in our environment and we can clearly see that we select, then filter.  The only real coding difference is now the filter function only includes the part about which rows to keep.  You do not need to specify a data object as input to a function if you're using piping. The pipe will always use the input that comes from above.  -->
<!-- Using pipes, you can link together as many functions as you like.  -->
<!-- ```{r} -->
<!-- # a complete piping example -->
<!-- all_pipes <- mpg %>%  -->
<!--   select(manufacturer, year, hwy, cty) %>%  -->
<!--   filter(year == 2008 & hwy <= 25) %>%  -->
<!--   rename( -->
<!--     make = manufacturer,  -->
<!--     hmpg = hwy,  -->
<!--     cmpg = cty -->
<!--     ) %>%  -->
<!--   arrange(-hmpg) -->
<!-- head(all_pipes) -->
<!-- ``` -->
<!-- A couple comments about piping: -->
<!-- * I find it very annoying to type the pipe operator (six key strokes!).  RStudio has a nice keyboard shortcut: `Crtl + Shift + M` for Windows (use `Cmd + Shift + M` on a mac). -->
<!-- * It's convention to start a new function on the next line after a pipe operator.  This makes the code easier to read and you can also comment out a single step in a long pipe.  -->
<!-- * Don't make your pipes too long, limit them to a particular data object or task. -->
<!-- ## Exercise 3 -->
<!-- Now that we know how to pipe functions, let's repeat exercise 2 with the Bight data.  You should already have code to import, select, and filter the data. In theory, you could create all of exercise 2 with a single continuous pipe.  That's a bit excessive so try to do this by creating only two objects in your workspace. Make one object the raw data and the second object the wrangled data.   -->
<!-- 1. Using your code from exercise two, try to replicate the steps using pipes.  The steps we used in exercise two were: -->
<!--      * Import the raw data with `read_excel` -->
<!--      * Select the columns `StationID`, `Parameter`, and `Result` -->
<!--      * Filter parameter to get only `Total_CHL` and `Total Organic Carbon` (hint: use `%in%`) -->
<!-- 2. When you're done, you should have a data object that's exactly the same as the one you created in exercise two. Try to verify this with the `identical` function from base R (check the help file with `?identical` if you don't know how to use this function). -->
<!-- ## Next time  -->
<!-- Now you should be able to answer (or be able to find answers to) the following: -->
<!-- * Why do we need to manipulate data? -->
<!-- * What is the tidyverse?  -->
<!-- * What can you do with dplyr? -->
<!-- * What is piping? -->
<!-- Next time we'll continue with data wrangling.  -->
<!-- ## Attribution -->
<!-- Content in this lesson was pillaged extensively from the USGS-R training curriculum [here](https://github.com/USGS-R/training-curriculum) and [R for data Science](https://github.com/hadley/r4ds). -->
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
