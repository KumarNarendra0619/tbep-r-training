<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data_Wrangling_1.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="css/styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">TBEP R Training</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="R_Basics.html">
    <span class="fas fa-university"></span>
     
    R Basics
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-wrench"></span>
     
    Data wrangling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Data_Wrangling_1.html">Part 1</a>
    </li>
    <li>
      <a href="Data_Wrangling_2.html">Part 2</a>
    </li>
  </ul>
</li>
<li>
  <a href="Viz_and_Graphics.html">
    <span class="fas fa-chart-line"></span>
     
    Viz and graphics
  </a>
</li>
<li>
  <a href="mapping.html">
    <span class="fas fa-globe-americas"></span>
     
    Spatial analysis and mapping
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Data_and_Resources.html">
    <span class="fas fa-list"></span>
     
    Data and resources
  </a>
</li>
<li>
  <a href="https://github.com/tbep-tech/tbep-r-training">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<script src="js/hideoutput.js"></script>
<div id="data-wrangling-part-1" class="section level1">
<h1>Data wrangling part 1</h1>
<p>Get the lesson R script: <a href="Data_Wrangling_1.R">Data_Wrangling_1.R</a></p>
<p>Get the lesson data: <a href="data/data.zip">download zip</a></p>
<div id="lesson-outline" class="section level2">
<h2>Lesson Outline</h2>
<ul>
<li><a href="#goals">Goals</a></li>
<li><a href="#the-tidyverse">The tidyverse</a></li>
<li><a href="#data-wrangling-with-dplyr">Data wrangling with <code>dplyr</code></a></li>
<li><a href="#piping">Piping</a></li>
</ul>
</div>
<div id="lesson-exercises" class="section level2">
<h2>Lesson Exercises</h2>
<ul>
<li><a href="#exercise-4">Exercise 4</a></li>
<li><a href="#exercise-5">Exercise 5</a></li>
</ul>
</div>
<div id="goals" class="section level2">
<h2>Goals</h2>
<p>Data wrangling (manipulation, ninjery, cleaning, etc.) is the part of any data analysis that will take the most time. While it may not necessarily be fun, it is foundational to all the work that follows. I strongly believe that mastering these skills has more value than mastering a particular analysis. Check out <a href="https://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html" target="_blank">this article</a> if you don’t believe me.</p>
<p>We’ll have two hours to cover parts 1 and 2 of data wrangling. It’s an unrealistic expectation that you will be a ninja wrangler after this training. As such, the goals are to expose you to fundamentals and to develop an appreciation of what’s possible. I also want to provide resources that you can use for follow-up learning on your own.</p>
<p>After this lesson you should be able to answer (or be able to find answers to) the following:</p>
<ul>
<li>Why do we need to manipulate data?</li>
<li>What is the tidyverse?</li>
<li>What can you do with dplyr?</li>
<li>What is piping?</li>
</ul>
</div>
<div id="the-tidyverse" class="section level2">
<h2>The tidyverse</h2>
<p>The <a href="https://www.tidyverse.org/" target="_blank">tidyverse</a> is a set of packages that work in harmony because they share common data representations and design. The tidyverse package is designed to make it easy to install and load core packages from the tidyverse in a single command. With tidyverse, you’ll be able to address all steps of data exploration.</p>
<p><img src="figure/data-science.png" /></p>
<p>From the excellent book, <a href="http://r4ds.had.co.nz/" target="_blank">R for Data Science</a>, <strong>data exploration</strong> is the art of looking at your data, rapidly generating hypotheses, quickly testing them, then repeating again and again and again. Tools in the tidyverse also have direct application to more formal analyses with many of the other available R packages on <a href="https://cran.r-project.org/" target="_blank">CRAN</a>.</p>
<p>You should already have the tidyverse installed, but let’s give it a go if you haven’t done this part yet:</p>
<pre class="r"><code># install
install.packages(&#39;tidyverse&#39;)</code></pre>
<p>After installation, we can load the package:</p>
<pre class="r"><code># load
library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.3     v purrr   0.3.4
## v tibble  3.1.0     v stringr 1.4.0
## v tidyr   1.1.3     v forcats 0.5.1
## v readr   1.4.0</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<p>Notice that the messages you get after loading are a bit different from other packages. That’s because tidyverse is a package that manages other packages. Loading tidyverse will load all of the core packagbes:</p>
<ul>
<li><a href="http://ggplot2.tidyverse.org" target="_blank">ggplot2</a>, for data visualisation.</li>
<li><a href="http://dplyr.tidyverse.org" target="_blank">dplyr</a>, for data manipulation.</li>
<li><a href="http://tidyr.tidyverse.org" target="_blank">tidyr</a>, for data tidying.</li>
<li><a href="http://readr.tidyverse.org" target="_blank">readr</a>, for data import.</li>
<li><a href="http://purrr.tidyverse.org" target="_blank">purrr</a>, for functional programming.</li>
<li><a href="http://tibble.tidyverse.org" target="_blank">tibble</a>, for tibbles, a modern re-imagining of data frames.</li>
</ul>
<p>Other packages (e.g., <code>readxl</code>) are also included but you will probably not use these as frequently.</p>
<p>A nice feature of tidyverse is the ability to check for and install new versions of each package:</p>
<pre class="r"><code>tidyverse_update()
#&gt; The following packages are out of date:
#&gt;  * broom (0.4.0 -&gt; 0.4.1)
#&gt;  * DBI   (0.4.1 -&gt; 0.5)
#&gt;  * Rcpp  (0.12.6 -&gt; 0.12.7)
#&gt; Update now?
#&gt;
#&gt; 1: Yes
#&gt; 2: No</code></pre>
<p>As you’ll soon learn using R, there are often several ways to achieve the same goal. The tidyverse provides tools to address problems that can be solved with other packages or even functions from the base installation. Tidyverse is admittedly an <em>opinionated</em> approach to data exploration, but it’s popularity and rapid growth within the R community is a testament to the power of the tools that are provided.</p>
</div>
<div id="data-wrangling-with-dplyr" class="section level2">
<h2>Data wrangling with <code>dplyr</code></h2>
<p><img src="figure/data-science-wrangle.png" /></p>
<p>The data wrangling process includes data import, tidying, and transformation. The process directly feeds into, and is not mutually exclusive, with the <em>understanding</em> or modelling side of data exploration. More generally, I consider data wrangling as the manipulation or combination of datasets for the purpose of analysis.</p>
<p>Wrangling begins with import and ends with an output of some kind, such as a plot or a model, but is more often a dataset that has been altered from a raw dataset to suit the needs of an analysis. In a perfect world, the wrangling process is linear with no need for back-tracking. In reality, we often uncover more information about a dataset, either through wrangling or modeling, that warrants re-evaluation or even gathering more data. Data also come in many forms and the form you need for analysis is rarely the required form of the input data. For these reasons, data wrangling will consume most of your time in data exploration.</p>
<p><strong>All wrangling is based on a purpose.</strong> No one wrangles for the sake of wrangling (usually), so the process always begins by answering the following two questions:</p>
<ul>
<li>What do my input data look like?</li>
<li>What should my input data look like given what I want to do?</li>
</ul>
<p>At the most basic level, going from what your data looks like to what it should look like will require a few key operations. Some common examples:</p>
<ul>
<li>Selecting specific variables</li>
<li>Filtering observations by some criteria</li>
<li>Adding or modifying existing variables</li>
<li>Renaming variables</li>
<li>Arranging rows by a variable</li>
<li>Summarizing variable conditional on others</li>
</ul>
<p>The <code>dplyr</code> package provides easy tools for these common data manipulation tasks. It is built to work directly with data frames and this is one of the foundational packages in what is now known as the tidyverse. The philosophy of dplyr is that one function does one thing and the name of the function says what it does. This is where the tidyverse generally departs from other packages and even base R. It is meant to be easy, logical, and intuitive. There is a lot of great info on dplyr. If you have an interest, I’d encourage you to look more. The vignettes are particularly good.</p>
<ul>
<li><a href="https://github.com/hadley/dplyr" target="_blank"><code>dplyr</code> GitHub repo</a></li>
<li><a href="http://cran.rstudio.com/web/packages/dplyr/" target="_blank">CRAN page: vignettes here</a></li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" target="_blank">Cheatsheet</a></li>
</ul>
<p>I’ll demonstrate the examples with the <code>fishdat</code> dataset from the last lesson. This dataset includes over 30000 catch records of fish from Old Tampa Bay.</p>
<pre class="r"><code># import the data
fishdat &lt;- read_csv(&#39;data/fishdat.csv&#39;)

# see first six rows
head(fishdat)</code></pre>
<pre><code>## # A tibble: 6 x 12
##   OBJECTID Reference     Sampling_Date    yr  Gear ExDate              Bluefish
##      &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;                 &lt;dbl&gt;
## 1  1550020 TBM1996032006 1996-03-20     1996   300 2018-04-12 10:27:38        0
## 2  1550749 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 3  1550750 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 4  1550762 TBM1996032207 1996-03-22     1996    20 2018-04-12 10:25:23        0
## 5  1550828 TBM1996042601 1996-04-26     1996   160 2018-04-12 10:25:23        0
## 6  1550838 TBM1996051312 1996-05-13     1996   300 2018-04-12 10:25:23        0
## # ... with 5 more variables: Common Snook &lt;dbl&gt;, Mullets &lt;dbl&gt;, Pinfish &lt;dbl&gt;,
## #   Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;</code></pre>
<pre class="r"><code># dimensions
dim(fishdat)</code></pre>
<pre><code>## [1] 2844   12</code></pre>
<pre class="r"><code># column names
names(fishdat)</code></pre>
<pre><code>##  [1] &quot;OBJECTID&quot;      &quot;Reference&quot;     &quot;Sampling_Date&quot; &quot;yr&quot;           
##  [5] &quot;Gear&quot;          &quot;ExDate&quot;        &quot;Bluefish&quot;      &quot;Common Snook&quot; 
##  [9] &quot;Mullets&quot;       &quot;Pinfish&quot;       &quot;Red Drum&quot;      &quot;Sand Seatrout&quot;</code></pre>
<pre class="r"><code># structure
str(fishdat)</code></pre>
<pre><code>## spec_tbl_df[,12] [2,844 x 12] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##  $ OBJECTID     : num [1:2844] 1550020 1550749 1550750 1550762 1550828 ...
##  $ Reference    : chr [1:2844] &quot;TBM1996032006&quot; &quot;TBM1996032004&quot; &quot;TBM1996032004&quot; &quot;TBM1996032207&quot; ...
##  $ Sampling_Date: Date[1:2844], format: &quot;1996-03-20&quot; &quot;1996-03-20&quot; ...
##  $ yr           : num [1:2844] 1996 1996 1996 1996 1996 ...
##  $ Gear         : num [1:2844] 300 22 22 20 160 300 300 300 300 22 ...
##  $ ExDate       : POSIXct[1:2844], format: &quot;2018-04-12 10:27:38&quot; &quot;2018-04-12 10:25:23&quot; ...
##  $ Bluefish     : num [1:2844] 0 0 0 0 0 0 0 0 0 0 ...
##  $ Common Snook : num [1:2844] 0 0 0 0 0 0 0 0 0 0 ...
##  $ Mullets      : num [1:2844] 0 0 0 0 0 0 0 0 0 0 ...
##  $ Pinfish      : num [1:2844] 0 54 0 80 0 0 0 0 1 1 ...
##  $ Red Drum     : num [1:2844] 0 0 1 0 4 0 0 0 0 0 ...
##  $ Sand Seatrout: num [1:2844] 1 0 0 0 0 1 5 66 0 0 ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   OBJECTID = col_double(),
##   ..   Reference = col_character(),
##   ..   Sampling_Date = col_date(format = &quot;&quot;),
##   ..   yr = col_double(),
##   ..   Gear = col_double(),
##   ..   ExDate = col_datetime(format = &quot;&quot;),
##   ..   Bluefish = col_double(),
##   ..   `Common Snook` = col_double(),
##   ..   Mullets = col_double(),
##   ..   Pinfish = col_double(),
##   ..   `Red Drum` = col_double(),
##   ..   `Sand Seatrout` = col_double()
##   .. )</code></pre>
<div id="selecting" class="section level3">
<h3>Selecting</h3>
<p>Let’s begin using dplyr. Don’t forget to load the tidyverse if you haven’t done so already. We can use the <code>select</code> function to, you guessed it, select columns.</p>
<pre class="r"><code># first, select some columns
dplyr_sel1 &lt;- select(fishdat, Sampling_Date, Gear, Pinfish)
head(dplyr_sel1)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   Sampling_Date  Gear Pinfish
##   &lt;date&gt;        &lt;dbl&gt;   &lt;dbl&gt;
## 1 1996-03-20      300       0
## 2 1996-03-20       22      54
## 3 1996-03-20       22       0
## 4 1996-03-22       20      80
## 5 1996-04-26      160       0
## 6 1996-05-13      300       0</code></pre>
<pre class="r"><code># select everything but ObjectId and ExDate
dplyr_sel2 &lt;- select(fishdat, -OBJECTID, -ExDate)
head(dplyr_sel2)</code></pre>
<pre><code>## # A tibble: 6 x 10
##   Reference    Sampling_Date    yr  Gear Bluefish `Common Snook` Mullets Pinfish
##   &lt;chr&gt;        &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 TBM19960320~ 1996-03-20     1996   300        0              0       0       0
## 2 TBM19960320~ 1996-03-20     1996    22        0              0       0      54
## 3 TBM19960320~ 1996-03-20     1996    22        0              0       0       0
## 4 TBM19960322~ 1996-03-22     1996    20        0              0       0      80
## 5 TBM19960426~ 1996-04-26     1996   160        0              0       0       0
## 6 TBM19960513~ 1996-05-13     1996   300        0              0       0       0
## # ... with 2 more variables: Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;</code></pre>
<pre class="r"><code># select columns that contain the letter c
dplyr_sel3 &lt;- select(fishdat, matches(&#39;c&#39;))
head(dplyr_sel3)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   OBJECTID Reference     `Common Snook`
##      &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt;
## 1  1550020 TBM1996032006              0
## 2  1550749 TBM1996032004              0
## 3  1550750 TBM1996032004              0
## 4  1550762 TBM1996032207              0
## 5  1550828 TBM1996042601              0
## 6  1550838 TBM1996051312              0</code></pre>
</div>
<div id="filtering" class="section level3">
<h3>Filtering</h3>
<p>After selecting columns, you’ll probably want to remove observations that don’t fit some criteria. For example, maybe you want to remove all rows with low catch or maybe you want to look only at fish caught in Gear 20 (a 21 m seine net).</p>
<pre class="r"><code># now filter observations with more than 30 Pinfish caught
dplyr_high_catch &lt;- filter(fishdat, Pinfish &gt; 30)
head(dplyr_high_catch)</code></pre>
<pre><code>## # A tibble: 6 x 12
##   OBJECTID Reference     Sampling_Date    yr  Gear ExDate              Bluefish
##      &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;                 &lt;dbl&gt;
## 1  1550749 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 2  1550762 TBM1996032207 1996-03-22     1996    20 2018-04-12 10:25:23        0
## 3  1555103 TBM1996022010 1996-02-20     1996    22 2018-04-12 10:25:29        0
## 4  1572931 TBM1996080603 1996-08-06     1996   160 2018-04-12 10:25:36        0
## 5  1572932 TBM1996080604 1996-08-06     1996   160 2018-04-12 10:25:36        0
## 6  1573079 TBM1996062104 1996-06-21     1996    20 2018-04-12 10:26:15        0
## # ... with 5 more variables: Common Snook &lt;dbl&gt;, Mullets &lt;dbl&gt;, Pinfish &lt;dbl&gt;,
## #   Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;</code></pre>
<pre class="r"><code># now filter observations for Gear type as 20
dplyr_gear20 &lt;- filter(fishdat, Gear == 20)
head(dplyr_gear20)</code></pre>
<pre><code>## # A tibble: 6 x 12
##   OBJECTID Reference     Sampling_Date    yr  Gear ExDate              Bluefish
##      &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;                 &lt;dbl&gt;
## 1  1550762 TBM1996032207 1996-03-22     1996    20 2018-04-12 10:25:23        0
## 2  1555259 TBM1996022104 1996-02-21     1996    20 2018-04-12 10:25:31        0
## 3  1573079 TBM1996062104 1996-06-21     1996    20 2018-04-12 10:26:15        0
## 4  1576651 TBM1996022007 1996-02-20     1996    20 2018-04-12 10:25:24        0
## 5  1584465 TBM1996061917 1996-06-19     1996    20 2018-04-12 10:26:04        0
## 6  1584803 TBM1996011905 1996-01-19     1996    20 2018-04-12 10:25:26        0
## # ... with 5 more variables: Common Snook &lt;dbl&gt;, Mullets &lt;dbl&gt;, Pinfish &lt;dbl&gt;,
## #   Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;</code></pre>
<p>Filtering can take a bit of time to master because there are several ways to tell R what you want. Within the filter function, the working part is a <em>logical selection</em> of <code>TRUE</code> and <code>FALSE</code> values that are used to select rows (<code>TRUE</code> means I want that row, <code>FALSE</code> means I don’t). Every selection within the filter function, no matter how complicated, will always be a T/F vector. This is similar to running queries on a database if you’re familiar with SQL.</p>
<p>To use filtering effectively, you have to know how to select the observations that you want using the comparison operators. R provides the standard suite: <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>!=</code> (not equal), and <code>==</code> (equal). When you’re starting out with R, the easiest mistake to make is to use <code>=</code> instead of <code>==</code> when testing for equality.</p>
<p>Multiple arguments to <code>filter()</code> are combined with “and”: every expression must be true in order for a row to be included in the output. For other types of combinations, you’ll need to use Boolean operators yourself: <code>&amp;</code> is “and”, <code>|</code> is “or”, and <code>!</code> is “not”. This is the complete set of Boolean operations.</p>
<p><img src="figure/transform-logical.png" /></p>
<p>Let’s start combining filtering operations.</p>
<pre class="r"><code># get rows with &gt; 30 and less than 100 Pinfish
filt1 &lt;- filter(fishdat, Pinfish &gt; 30 &amp; Pinfish &lt; 100)
head(filt1)</code></pre>
<pre><code>## # A tibble: 6 x 12
##   OBJECTID Reference     Sampling_Date    yr  Gear ExDate              Bluefish
##      &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;                 &lt;dbl&gt;
## 1  1550749 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 2  1550762 TBM1996032207 1996-03-22     1996    20 2018-04-12 10:25:23        0
## 3  1555103 TBM1996022010 1996-02-20     1996    22 2018-04-12 10:25:29        0
## 4  1572931 TBM1996080603 1996-08-06     1996   160 2018-04-12 10:25:36        0
## 5  1573079 TBM1996062104 1996-06-21     1996    20 2018-04-12 10:26:15        0
## 6  1635253 TBM1997031016 1997-03-10     1997    20 2018-04-12 10:29:33        0
## # ... with 5 more variables: Common Snook &lt;dbl&gt;, Mullets &lt;dbl&gt;, Pinfish &lt;dbl&gt;,
## #   Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;</code></pre>
<pre class="r"><code># get rows with gear type 20 or red drum larger than 40
filt2 &lt;- filter(fishdat, Gear == 20 | `Red Drum` &gt; 40)
head(filt2)</code></pre>
<pre><code>## # A tibble: 6 x 12
##   OBJECTID Reference     Sampling_Date    yr  Gear ExDate              Bluefish
##      &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;                 &lt;dbl&gt;
## 1  1550762 TBM1996032207 1996-03-22     1996    20 2018-04-12 10:25:23        0
## 2  1555259 TBM1996022104 1996-02-21     1996    20 2018-04-12 10:25:31        0
## 3  1573079 TBM1996062104 1996-06-21     1996    20 2018-04-12 10:26:15        0
## 4  1576651 TBM1996022007 1996-02-20     1996    20 2018-04-12 10:25:24        0
## 5  1584465 TBM1996061917 1996-06-19     1996    20 2018-04-12 10:26:04        0
## 6  1584803 TBM1996011905 1996-01-19     1996    20 2018-04-12 10:25:26        0
## # ... with 5 more variables: Common Snook &lt;dbl&gt;, Mullets &lt;dbl&gt;, Pinfish &lt;dbl&gt;,
## #   Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;</code></pre>
<pre class="r"><code># get rows gear 20 or gear 5
filt3 &lt;- filter(fishdat, Gear == 20 | Gear == 5)
head(filt3)</code></pre>
<pre><code>## # A tibble: 6 x 12
##   OBJECTID Reference     Sampling_Date    yr  Gear ExDate              Bluefish
##      &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;                 &lt;dbl&gt;
## 1  1550762 TBM1996032207 1996-03-22     1996    20 2018-04-12 10:25:23        0
## 2  1555259 TBM1996022104 1996-02-21     1996    20 2018-04-12 10:25:31        0
## 3  1573079 TBM1996062104 1996-06-21     1996    20 2018-04-12 10:26:15        0
## 4  1576651 TBM1996022007 1996-02-20     1996    20 2018-04-12 10:25:24        0
## 5  1584465 TBM1996061917 1996-06-19     1996    20 2018-04-12 10:26:04        0
## 6  1584803 TBM1996011905 1996-01-19     1996    20 2018-04-12 10:25:26        0
## # ... with 5 more variables: Common Snook &lt;dbl&gt;, Mullets &lt;dbl&gt;, Pinfish &lt;dbl&gt;,
## #   Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;</code></pre>
<pre class="r"><code># get rows with gear 20 or gear 5 using different syntax
filt4 &lt;- filter(fishdat, Gear %in% c(20, 5))
head(filt4)</code></pre>
<pre><code>## # A tibble: 6 x 12
##   OBJECTID Reference     Sampling_Date    yr  Gear ExDate              Bluefish
##      &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;                 &lt;dbl&gt;
## 1  1550762 TBM1996032207 1996-03-22     1996    20 2018-04-12 10:25:23        0
## 2  1555259 TBM1996022104 1996-02-21     1996    20 2018-04-12 10:25:31        0
## 3  1573079 TBM1996062104 1996-06-21     1996    20 2018-04-12 10:26:15        0
## 4  1576651 TBM1996022007 1996-02-20     1996    20 2018-04-12 10:25:24        0
## 5  1584465 TBM1996061917 1996-06-19     1996    20 2018-04-12 10:26:04        0
## 6  1584803 TBM1996011905 1996-01-19     1996    20 2018-04-12 10:25:26        0
## # ... with 5 more variables: Common Snook &lt;dbl&gt;, Mullets &lt;dbl&gt;, Pinfish &lt;dbl&gt;,
## #   Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;</code></pre>
<p>As a side note, any variable (i.e., column name) with spaces or non-standard characters can be referenced by enclosing it with backticks (see <a href="http://adv-r.had.co.nz/Environments.html#binding" target="_blank">here</a>).</p>
</div>
<div id="mutating" class="section level3">
<h3>Mutating</h3>
<p>Now that we’ve seen how to filter observations and select columns of a data frame, maybe we want to add a new column. In dplyr, <code>mutate</code> allows us to add new columns. These can be vectors you are adding or based on expressions applied to existing columns. For instance, we have a column for average size in mm and maybe we want to convert to cm.</p>
<pre class="r"><code># add a column as bluefish divided by 100
dplyr_mut &lt;- mutate(fishdat, Bluefish_p100 = Bluefish / 100)
head(dplyr_mut)</code></pre>
<pre><code>## # A tibble: 6 x 13
##   OBJECTID Reference     Sampling_Date    yr  Gear ExDate              Bluefish
##      &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;                 &lt;dbl&gt;
## 1  1550020 TBM1996032006 1996-03-20     1996   300 2018-04-12 10:27:38        0
## 2  1550749 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 3  1550750 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 4  1550762 TBM1996032207 1996-03-22     1996    20 2018-04-12 10:25:23        0
## 5  1550828 TBM1996042601 1996-04-26     1996   160 2018-04-12 10:25:23        0
## 6  1550838 TBM1996051312 1996-05-13     1996   300 2018-04-12 10:25:23        0
## # ... with 6 more variables: Common Snook &lt;dbl&gt;, Mullets &lt;dbl&gt;, Pinfish &lt;dbl&gt;,
## #   Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;, Bluefish_p100 &lt;dbl&gt;</code></pre>
<pre class="r"><code># add a column for many/few mullet
dplyr_mut2 &lt;- mutate(fishdat, mullet_cat = ifelse(Mullets &lt; 20, &#39;few&#39;, &#39;many&#39;))
head(dplyr_mut2)</code></pre>
<pre><code>## # A tibble: 6 x 13
##   OBJECTID Reference     Sampling_Date    yr  Gear ExDate              Bluefish
##      &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;                 &lt;dbl&gt;
## 1  1550020 TBM1996032006 1996-03-20     1996   300 2018-04-12 10:27:38        0
## 2  1550749 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 3  1550750 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 4  1550762 TBM1996032207 1996-03-22     1996    20 2018-04-12 10:25:23        0
## 5  1550828 TBM1996042601 1996-04-26     1996   160 2018-04-12 10:25:23        0
## 6  1550838 TBM1996051312 1996-05-13     1996   300 2018-04-12 10:25:23        0
## # ... with 6 more variables: Common Snook &lt;dbl&gt;, Mullets &lt;dbl&gt;, Pinfish &lt;dbl&gt;,
## #   Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;, mullet_cat &lt;chr&gt;</code></pre>
<p>Some other useful dplyr functions include <code>arrange</code> to sort the observations (rows) by a column and <code>rename</code> to (you guessed it) rename a column.</p>
<pre class="r"><code># arrange by maximum size
dplyr_arr &lt;- arrange(fishdat, `Sand Seatrout`)
head(dplyr_arr)</code></pre>
<pre><code>## # A tibble: 6 x 12
##   OBJECTID Reference     Sampling_Date    yr  Gear ExDate              Bluefish
##      &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;                 &lt;dbl&gt;
## 1  1550749 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 2  1550750 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 3  1550762 TBM1996032207 1996-03-22     1996    20 2018-04-12 10:25:23        0
## 4  1550828 TBM1996042601 1996-04-26     1996   160 2018-04-12 10:25:23        0
## 5  1551311 TBM1996032209 1996-03-22     1996   300 2018-04-12 10:25:20        0
## 6  1551335 TBM1996041807 1996-04-18     1996    22 2018-04-12 10:25:24        0
## # ... with 5 more variables: Common Snook &lt;dbl&gt;, Mullets &lt;dbl&gt;, Pinfish &lt;dbl&gt;,
## #   Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;</code></pre>
<pre class="r"><code># rename some columns
dplyr_rnm &lt;- rename(fishdat, snook = `Common Snook`)
head(dplyr_rnm)</code></pre>
<pre><code>## # A tibble: 6 x 12
##   OBJECTID Reference     Sampling_Date    yr  Gear ExDate              Bluefish
##      &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;                 &lt;dbl&gt;
## 1  1550020 TBM1996032006 1996-03-20     1996   300 2018-04-12 10:27:38        0
## 2  1550749 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 3  1550750 TBM1996032004 1996-03-20     1996    22 2018-04-12 10:25:23        0
## 4  1550762 TBM1996032207 1996-03-22     1996    20 2018-04-12 10:25:23        0
## 5  1550828 TBM1996042601 1996-04-26     1996   160 2018-04-12 10:25:23        0
## 6  1550838 TBM1996051312 1996-05-13     1996   300 2018-04-12 10:25:23        0
## # ... with 5 more variables: snook &lt;dbl&gt;, Mullets &lt;dbl&gt;, Pinfish &lt;dbl&gt;,
## #   Red Drum &lt;dbl&gt;, Sand Seatrout &lt;dbl&gt;</code></pre>
<p>There are many more functions in <code>dplyr</code> but the ones above are by far the most used. As you can imagine, they are most effective when used together because there is never only one step in the data wrangling process. After the exercise, we’ll talk about how we can efficiently <em>pipe</em> the functions in dplyr to create a new data object.</p>
</div>
</div>
<div id="exercise-4" class="section level2">
<h2>Exercise 4</h2>
<p>Now that you know the basic functions in <code>dplyr</code> and how to use them, let’s put them to use. Using <code>fishdat</code>, let’s select some columns of interest, filter by gear type, and rename one of the columns.</p>
<ol style="list-style-type: decimal">
<li><p>Select the <code>Reference</code>, <code>Sampling_Date</code>, <code>Gear</code>, and <code>Sand Seatrout</code> columns. Assign this dataset to a new object in your workspace. Don’t forget to use backticks to select column names that have spaces.</p></li>
<li><p>Using the new object, filter to get all rows where Gear is equal to 20 (hint, filter by the <code>Gear</code> column and don’t forget ot use <code>==</code>).</p></li>
<li><p>Rename the <code>Sampling_Date</code> column to <code>date</code>.</p></li>
</ol>
<div class="fold s o">
<pre class="r"><code>ex1 &lt;- select(fishdat, Reference, Sampling_Date, Gear, `Sand Seatrout`)
ex1 &lt;- filter(ex1, Gear == 20)
ex1 &lt;- rename(ex1, date = Sampling_Date)
nrow(ex1)</code></pre>
</div>
</div>
<div id="piping" class="section level2">
<h2>Piping</h2>
<p>A complete data wrangling exercise will always include multiple steps to go from the raw data to the output you need. Here’s a terrible wrangling example using functions from base R:</p>
<pre class="r"><code>cropdat &lt;- rawdat[1:28]
savecols &lt;- data.frame(cropdat$Party, cropdat$`Last Inventory Year (2015)`)
names(savecols) &lt;- c(&#39;Party&#39;,&#39;2015&#39;)
savecols$rank2015 &lt;- rank(-savecols$`2015`)
top10df &lt;- savecols[savecols$rank2015 &lt;= 10,]
basedat &lt;- cropdat[cropdat$Party %in% top10df$Party,]</code></pre>
<p>Technically, if this works it’s not “wrong”, but there are a couple of issues that can lead to problems down the line. First, the flow of functions to manipulate the data is not obvious and this makes your code very hard to read. Second, lots of unecessary intermediates have been created in your workspace. Anything that adds to clutter should be avoided because R is fundamentally based on object assignments. The less you assign as a variable in your environment the easier it will be to navigate complex scripts.</p>
<p>The good news is that you now know how to use the dplyr functions to wrangle data. The function names in dplyr were chosen specifically to be descriptive. This will make your code much more readable than if you were using base R counterparts. The bad news is that I haven’t told you how to easily link the functions. Fortunately, there’s an easy fix to this problem.</p>
<p>The <code>magrittr</code> package (comes with tidyverse) provides a very useful method called <em>piping</em> that will make wrangling a whole lot easier. The idea is simple: a pipe (<code>%&gt;%</code>) is used to chain functions together. The output from one function becomes the input to the next function in the pipe. This avoids the need to create intermediate objects and creates a logical progression of steps that demystify the wrangling process.</p>
<p>Consider the simple example:</p>
<pre class="r"><code># not using pipes, select a column, filter rows
bad_ex &lt;- select(fishdat, Gear, `Common Snook`)
bad_ex2 &lt;- filter(bad_ex, `Common Snook` &gt; 25)</code></pre>
<p>With pipes, it looks like this:</p>
<pre class="r"><code># with pipes, select a column, filter rows
good_ex &lt;- fishdat %&gt;% 
  select(Gear, `Common Snook`) %&gt;%
  filter(`Common Snook` &gt; 25)</code></pre>
<p>Now we’ve created only one new object in our environment and we can clearly see that we select, then filter. The only real coding difference is now the select and filter functions only include the relevant information. You do not need to specify a data object as input to a function if you’re using piping. The pipe will always use the input that comes from above.</p>
<p>A couple comments about piping:</p>
<ul>
<li>I find it very annoying to type the pipe operator (six key strokes!). RStudio has a nice keyboard shortcut: <code>Crtl + Shift + M</code> for Windows (use <code>Cmd + Shift + M</code> on a mac).</li>
<li>It’s convention to start a new function on the next line after a pipe operator. This makes the code easier to read and you can also comment out a single step in a long pipe.</li>
<li>Don’t make your pipes too long, limit them to a particular data object or task.</li>
</ul>
</div>
<div id="exercise-5" class="section level2">
<h2>Exercise 5</h2>
<p>Now that we know how to pipe functions, let’s repeat exercise 4. You should already have code to select and filter the data. Use the following to repeat the analysis but with pipes. You should only have to create one data object in this exercise.</p>
<ol style="list-style-type: decimal">
<li>Using your code from exercise four, try to replicate the steps using pipes. The steps we used in exercise four were:
<ul>
<li>From fishdat, select the <code>Reference</code>, <code>Sampling_Date</code>, <code>Gear</code>, and <code>Sand Seatrout</code> columns</li>
<li>Filter by <code>Gear</code> to get only gear 20</li>
<li>Rename <code>Sampling_Date</code> to <code>date</code></li>
</ul></li>
</ol>
<div class="fold s o">
<pre class="r"><code>ex2 &lt;- fishdat %&gt;% 
  select(Reference, Sampling_Date, Gear, `Sand Seatrout`) %&gt;% 
  filter(Gear == 20) %&gt;% 
  rename(date = Sampling_Date)
head(ex2)</code></pre>
</div>
</div>
<div id="next-time" class="section level2">
<h2>Next time</h2>
<p>Now you should be able to answer (or be able to find answers to) the following:</p>
<ul>
<li>Why do we need to manipulate data?</li>
<li>What is the tidyverse?</li>
<li>What can you do with dplyr?</li>
<li>What is piping?</li>
</ul>
<p>Next we’ll continue with data wrangling.</p>
</div>
<div id="attribution" class="section level2">
<h2>Attribution</h2>
<p>Content in this lesson was pillaged extensively from the USGS-R training curriculum <a href="https://github.com/USGS-R/training-curriculum" target="_blank">here</a> and <a href="https://github.com/hadley/r4ds" target="_blank">R for data Science</a>.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
